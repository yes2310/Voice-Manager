const express = require('express');
const router = express.Router();
const Schedule = require('../models/Schedule');

// âœ… GET: ì „ì²´ ì¼ì • ì¡°íšŒ
router.get('/', async (req, res) => {
  try {
    const schedules = await Schedule.find({});
    res.json(schedules);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// âœ… POST: ì¼ì • ë“±ë¡
router.post('/', async (req, res) => {
  try {
    const schedule = new Schedule(req.body);
    await schedule.save();
    res.status(201).json({ message: 'ì¼ì • ë“±ë¡ ì™„ë£Œ', schedule });
  } catch (err) {
    res.status(400).json({ error: err.message });
  }
});

router.put('/:id', async (req, res) => {
  try {
    const { id } = req.params;
    const updates = req.body; // { startTime, endTime, ... }
    const schedule = await Schedule.findByIdAndUpdate(id, updates, { new: true });
    if (!schedule) {
      return res.status(404).json({ error: 'ì¼ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' });
    }
    res.json({ message: 'ì¼ì • ìˆ˜ì • ì™„ë£Œ', schedule });
  } catch (err) {
    res.status(400).json({ error: err.message });
  }
});

// routes/scheduleRoutes.js
router.get('/', async (req, res) => {
  console.log('ğŸ“¥ GET /api/schedules í˜¸ì¶œë¨');
  try {
    const schedules = await Schedule.find({});
    console.log(`   â–¶ ì¼ì • ê°œìˆ˜: ${schedules.length}`);
    res.json(schedules);
  } catch (err) {
    console.error('âŒ GET /api/schedules ì—ëŸ¬:', err);
    res.status(500).json({ error: err.message });
  }
});

module.exports = router;
